"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["17648"],{80140:function(e,t,n){n.d(t,{A:()=>o});let o={footerButtons:"footerButtons-ap9Sk7",footerSubstackCta:"footerSubstackCta-v5HWfj",noIcon:"noIcon-z7v9D8",sizeSm:"sizeSm-F_aC8H",sizeSmNoIcon:"sizeSmNoIcon-KRHkpZ",getTheApp:"getTheApp-Yk3w1O",appUpsell:"appUpsell-ZCFh94"}},22065:function(e,t,n){n.d(t,{A:()=>o});let o={container:"container-PNh5cP",containerBulwark:"containerBulwark-Y0wz4B",noPodcasts:"noPodcasts-reia2s"}},49092:function(e,t,n){n.d(t,{Z:()=>er});var o=n(4006),i=n(45994),r=n(15734),a=n.n(r),s=n(84605),l=n(35369),c=n(76977),u=n(16993),d=n(63136);let m=e=>{let{isOpen:t,onContinue:n}=e,{iString:r}=(0,s.GO)(),[a,m]=(0,i.J0)(!1);return(0,o.FD)(u.aF,{isOpen:t,children:[(0,o.Y)(u.rQ,{title:r("Switch to Bitcoin"),showClose:!1}),(0,o.Y)(u.cw,{children:(0,o.FD)(c.I1,{gap:24,children:[(0,o.FD)(c.I1,{gap:16,children:[(0,o.Y)(d.EY.B4,{translated:!0,children:"Switching to Bitcoin will end your auto-renewing credit card payments."}),(0,o.FD)(d.EY.B4,{translated:!0,children:["Please note that Substack cannot process refunds or auto-renewals for Bitcoin payments. You will now be sent to"," ",(0,o.Y)("a",{href:"https://opennode.com",target:"_blank",rel:"noopener",children:"OpenNode"})," ","to complete your checkout."]})]}),(0,o.Y)(l.$n,{onClick:()=>{m(!0),n()},disabled:a,children:r("Continue")})]})})]})};var p=n(66803),_=n(50180),h=n(32485),y=n.n(h),f=n(65842);let g="themed-qm5g5y",b=e=>{let{placeholder:t,maxLength:n,value:i,symbol:r,themed:a=!1,onChange:s}=e;return(0,o.FD)(c.Ye,{alignItems:"center",justifyContent:"start",className:y()("inputContainer-JJXl4U",{[g]:a}),children:[(0,o.Y)(d.EY.B3,{as:"span",color:a?"pub-secondary-text":"secondary",weight:"semibold",className:"currencyInput-n4aG03",children:r}),(0,o.Y)(f.ks,{name:"Confirm Founding Price","aria-label":"Confirm founding price",value:i,placeholder:t,maxLength:n,onChange:e=>s(e.currentTarget.value),onInput:e=>s(e.currentTarget.value),className:y()("inputField-ZlLLCs",{[g]:a})})]})};var v=n(86500),w=n(82776);let Y=e=>{let{currency:t,isValid:n,newUpgradeModal:r,planName:a,price:l,setValidationState:u}=e,[m,h]=(0,i.J0)(""),y=parseInt(l);(0,i.vJ)(()=>((0,v.u4)(v.qY.FOUNDING_PRICE_CONFIRMATION_REQUIRED,{price:l,source:"upgrade modal"}),()=>{n||(0,v.u4)(v.qY.FOUNDING_PRICE_CONFIRMATION_DISMISSED,{price:l,source:"upgrade modal"})}),[]);let{iString:f}=(0,s.GO)(),g=(0,w.isZeroDecimalCurrency)(t)?1:100;return(0,o.FD)(c.I1,{font:r?"text":void 0,gap:8,paddingTop:8*!r,borderTop:r?void 0:"detail",alignItems:"start",justifyContent:"start",children:[(0,o.FD)(d.EY,{translated:!0,as:"p",size:r?14:17,color:"secondary",children:["Please confirm you want to pay"," ",(0,o.Y)(d.EY,{as:"span",color:"primary",weight:"semibold",children:I18N.p(y?(0,w.centsToPriceString)(y*g,t):l)})," ","per year for a ",I18N.p(null!=a?a:f("Founding Member"))," subscription by typing the price below."]}),(0,o.FD)(c.Ye,{alignItems:"center",justifyContent:"start",gap:8,style:{width:"100%"},children:[(0,o.Y)(b,{placeholder:l,symbol:(0,w.currencySymbol)(t),maxLength:l.length,value:m,themed:!1,onChange:e=>{e===l?(u(!0),h(e)):e!==m&&(u(!1),h(e))}}),n?(0,o.Y)(p.A,{size:24,style:{color:"var(--color-accent-fg-green)"}}):(0,o.Y)(_.A,{size:24,style:{color:"var(--color-accent-fg-red)"}})]})]})};var C=n(33031),P=n.n(C),S=n(69277),I=n(70408),A=n(79785),D=n(17402),k=n(97731);let x=e=>(0,o.Y)(k.A,(0,I._)((0,S._)({},e),{name:"WarningIcon",svgParams:{viewBox:"-2 -2 18 18"},children:(0,o.Y)("path",{d:"M8 0C3.582 0 0 3.582 0 8s3.582 8 8 8 8-3.582 8-8S12.418 0 8 0zM9 12H7v-2h2V12zM9 8H7V4h2V8z"})}));var F=n(66511),N=n(67734);function E(){let e=(0,A._)([" per ",""]);return E=function(){return e},e}function M(){let e=(0,A._)(["Amount must be greater than ",""]);return M=function(){return e},e}let B=e=>{var t;let{amount:n,currency:i,isSelected:r,outlineOnSelect:a,plan:l,usePer:c,showDuration:u=!0,disableInput:d=!1,className:m,disableWarning:p,onChangeAmount:_,truncateInterval:h=!1}=e,f=(0,D.useRef)(null),[g,b]=(0,D.useState)(!1),v=(0,D.useCallback)(e=>{_(e.toString().replace(/[^\d.]/g,""))},[_]);i||(i=l.currency),(0,D.useEffect)(()=>{let e=(0,N.oW)(l,i);b(!!(!p&&e&&null!==n&&i&&parseFloat(Number((0,w.isZeroDecimalCurrency)(i)?n:100*Number(n)).toFixed(2))<e&&r))},[n,i,p,r,l]),(0,D.useLayoutEffect)(()=>{setTimeout(()=>{f.current&&(f.current.style.width="1px",f.current.style.width="".concat(f.current.scrollWidth,"px"),f.current.scrollLeft=0)},0)},[n,f]),(0,D.useEffect)(()=>{r&&(f.current.focus(),f.current.select())},[f,r]);let{iTemplate:Y,iString:C}=(0,s.GO)(),P=h&&"year"===l.interval?"yr":h&&"month"===l.interval?"mo":l.interval;return(0,o.FD)("span",{className:y()("outlineWrapper-MqmfKS",m,{"outlineWrapperSelected-KXkgz5":a&&r,"outlineWrapperWithWarning-x5ALXu":g}),children:[(0,w.centsToPriceString)(100,i).replace("1",""),(0,o.Y)("input",{disabled:d,ref:f,className:y()("amountInput-pcn7kh",{"amountInputDeselected-W75Nrd":!r}),id:"money-variable-amount",type:"text","aria-label":"founding member amount",autoComplete:"off",value:"string"==typeof n?n:l.amount/100,onKeyDown:e=>{"ArrowUp"===e.key?(v(Number(n||l.amount/100)+5),setTimeout(()=>{f.current.selectionStart=f.current.selectionEnd=f.current.value.length},0)):"ArrowDown"===e.key&&(!n||Number(n)>=5)&&(v(Number(n||l.amount/100)-5),setTimeout(()=>{f.current.selectionStart=f.current.selectionEnd=f.current.value.length},0))},onInput:e=>{v(e.target.value)}}),(0,o.Y)("input",{name:"amount",type:"hidden",value:"string"==typeof n?100*(Number(n)||0):l.amount}),u&&"forever"!==l.interval&&(c?Y(E(),C(P)):"/".concat(C(P))),g&&(0,o.Y)("div",{className:"warningContainer-lQlVcA",children:(0,o.Y)(F.m_,{text:Y(M(),(0,w.centsToPriceString)(null!=(t=(0,N.oW)(l,i))?t:0,i)),children:(0,o.Y)(x,{stroke:"white",height:20,fill:"red",strokeWidth:1})})})]})};var T=n(93946),L=n(81929);let q=e=>{let{coupon:t,currency:n,foundingAmount:i,foundingName:r,isSelected:a,isCurrent:l,language:u,plan:m,onChangeAmount:p}=e,{iString:_}=(0,s.GO)(),h=null==t?void 0:t.include_founding_plans;return(0,o.FD)(c.fI,{alignItems:"center",flex:"grow",gap:12,justifyContent:"space-between",children:[(0,o.Y)(d.EY.B4,{weight:a?"semibold":"regular",children:(0,o.FD)(c.VP,{gap:4,children:[(0,o.Y)(d.EY,{children:r}),h?(0,o.Y)(c.VP,{gap:4,children:(0,o.Y)(d.EY.B4,{weight:"semibold",color:"secondary",children:(0,T.Ac)(m,{language:u,currency:n,discount:t?(0,I._)((0,S._)({},t),{loading:!1}):void 0,recurring:!0})})}):(0,o.Y)(B,{amount:i?i.toString():"",currency:n,isSelected:a,plan:m,usePer:!0,onChangeAmount:e=>{p(Number(e))}})]})}),l&&(0,o.Y)(L.vw,{priority:"secondary",children:_("Current")})]})},O=e=>{let{currency:t,coupon:n,plan:i,isCurrent:r,isSelected:a,language:l}=e,{iString:u}=(0,s.GO)();return(0,o.FD)(c.fI,{alignItems:"center",flex:"grow",gap:12,justifyContent:"space-between",children:[(0,o.Y)(d.EY.B4,{weight:a?"semibold":"regular",children:(0,T.Ac)(i,{currency:t,noTrial:!0,recurring:!0,language:l,discount:n?(0,I._)((0,S._)({},n),{loading:!1}):void 0})}),r&&(0,o.Y)(L.vw,{priority:"secondary",children:u("Current")})]})};var J=n(33727),U=n(95477),V=n(54584),z=n(27162);let R=e=>{let{coupon:t,currency:n,foundingAmount:i,foundingName:r,isCurrent:a,language:s,plan:l,isSelected:c,sub:u,onChangePlan:d,onChangeFoundingAmount:m}=e,p=(0,V.Ns)(t,u,l)?t:void 0;return(0,o.FD)(J.Z,{as:"label",direction:"row",alignItems:"center",gap:12,padding:16,radius:"sm",cursor:"pointer",pressable:"lg",outline:c?"accent":"detail",className:c&&"selected-Rkwzkv",children:[(0,o.Y)(U.s,{checked:c,name:"plan",value:l.id,onClick:e=>{d({planId:e.target.value})}}),(0,z.T)({plan:l})?(0,o.Y)(q,{coupon:p,currency:n,foundingAmount:i,foundingName:r,isCurrent:a,isSelected:c,language:s,plan:l,onChangeAmount:m}):(0,o.Y)(O,{currency:n,coupon:p,plan:l,isCurrent:a,isSelected:c,language:s})]})},W=e=>{let{coupon:t,currency:n,foundingAmount:i,foundingName:r,getIsCurrentPlan:a,language:s,plans:l,selectedPlanId:u,sub:d,onChangeFoundingAmount:m,onChangePlan:p}=e,_=P()(l,"amount").filter(e=>{var t;return!(null==(t=e.metadata)?void 0:t.bitcoin)}),h=null!=u?u:"";return(0,o.Y)(c.VP,{gap:12,flex:{desktop:"grow",mobile:"auto"},children:_.map(e=>(0,o.Y)(R,{coupon:t,currency:n,foundingAmount:i,foundingName:r,isCurrent:a(e),isSelected:e.id===h,language:s,plan:e,sub:d,onChangePlan:p,onChangeFoundingAmount:m}))})};var K=n(16074),G=n(16291),Z=n(56458);function j(){let e=(0,A._)(["Enjoy ","% off for \n          ","\n          . Afterward, your subscription renews on "," at "]);return j=function(){return e},e}let Q=e=>{var t,n,i;let{coupon:r,currency:a,foundingAmount:l,foundingAmountLessThanMinimum:u,foundingName:m,hasChanges:p,sub:_,isNewPlanClassicFounding:h,newPlan:y}=e,{iString:f,iTemplate:g,language:b}=(0,s.GO)(),v=(0,w.isZeroDecimalCurrency)(a)?1:100,Y=Math.floor((e=>{if(!e.totalAmount)return 0;let t=e.totalAmount;if(e.discount){var n,o;(null==(n=e.discount.coupon)?void 0:n.percent_off)?t=Math.round(t*(1-e.discount.coupon.percent_off/100)):(null==(o=e.discount.coupon)?void 0:o.amount_off)&&(t=Math.max(0,t-e.discount.coupon.amount_off))}let i=Number(e.current_period_start),r=Math.round(Date.now()/1e3),a=Number(e.current_period_end)-i;return(1-(r-i)/a)*Number(t)})(_)),C=p&&y&&(!h||!u),P=f("n/a");if(C)if(h&&(null==r?void 0:r.include_founding_plans)){let e=null!=(n=(0,N.id)(y,a))?n:0;r.percent_off?e=Math.round(e*(1-(r.percent_off_precise||r.percent_off)/100)):r.amount_off&&(e=Math.max(0,e-r.amount_off)),e=Math.max(0,e-Y),P=(0,w.centsToPriceString)(e,a)}else if(h)P="".concat((0,w.centsToPriceString)((null!=l?l:0)*v,a)," ").concat(f("per year"));else if(r){let e=null!=(i=(0,N.id)(y,a))?i:0;r.percent_off?e=Math.round(e*(1-(r.percent_off_precise||r.percent_off)/100)):r.amount_off&&(e=Math.max(0,e-r.amount_off)),e=Math.max(0,e-Y),P=(0,w.centsToPriceString)(e/100*v,a)}else P=(0,T.Ac)(y,{language:b,currency:a});let A=y?(0,T.Ac)(y,{language:b,currency:a}):null,D=(0,G.A)().add(Number(null==y?void 0:y.interval_count),null==y?void 0:y.interval).format("MMM D, YYYY");return(0,o.FD)(J.Z,{shadow:"none",gap:20,padding:16,children:[(0,o.FD)(c.Ye,{justifyContent:"space-between",children:[(0,o.Y)(d.EY.B3,{weight:"semibold",children:f("Summary")}),(0,o.FD)(d.EY.B4,{color:"secondary",children:[" ",null==r?void 0:r.name," "]})]}),(0,o.FD)("div",{className:"grid-NonZWA",children:[_.plan&&(0,o.FD)(o.FK,{children:[(0,o.Y)(d.EY.B4,{children:f("Current plan")}),(0,o.FD)(c.VP,{"data-testid":"upgrade-summary-current-plan",gap:4,children:[(0,o.Y)(d.EY.B4,{align:"right",children:(0,Z.Vr)({sub:_})?m:H({plan:_.plan,language:b,currency:a,discount:null==(t=_.discount)?void 0:t.coupon})}),(0,Z.Vr)({sub:_})&&(0,o.Y)(d.EY.B4,{color:"secondary",align:"right",children:(0,T.Ac)(_.plan,{language:b,currency:a})})]})]}),(0,o.Y)(d.EY.B4,{children:f("New plan")}),(0,o.Y)(c.VP,{"data-testid":"upgrade-summary-new-plan",gap:4,children:(0,o.Y)(d.EY.B4,{align:"right",weight:"regular",color:C?"primary":"secondary",children:y&&r&&C?(0,T.Ac)(y,{language:b,currency:a,discount:r?(0,I._)((0,S._)({},r),{loading:!1}):void 0}):P})}),r&&(0,o.FD)(o.FK,{children:[(0,o.FD)(c.VP,{"data-testid":"upgrade-summary-credit",children:[(0,o.Y)(d.EY.B4,{weight:"regular",children:f("Credit")}),(0,o.FD)(d.EY.B5,{weight:"regular",children:[(0,G.A)(1e3*Number(_.current_period_end)).diff((0,G.A)(),"days")," ",f("unused days")]})]}),(0,o.Y)(d.EY.B4,{"data-testid":"upgrade-summary-total",align:"right",color:C?"primary":"secondary",weight:"regular",children:(0,w.centsToPriceString)(Y/100*v,a)})]}),(0,o.Y)(K.c,{className:"table-divider-O5XQ7c"}),r?(0,o.FD)(o.FK,{children:[(0,o.Y)(d.EY.B4,{weight:"semibold",children:f("Charge today")}),(0,o.Y)(c.VP,{children:(0,o.Y)(d.EY.B4,{"data-testid":"upgrade-summary-total",align:"right",color:C?"primary":"secondary",weight:C?"semibold":"regular",children:P})})]}):(0,o.FD)(o.FK,{children:[(0,o.Y)(d.EY.B4,{weight:"semibold",children:f("Total")}),(0,o.Y)(d.EY.B4,{"data-testid":"upgrade-summary-total",align:"right",color:C?"primary":"secondary",weight:C?"semibold":"regular",children:P})]})]}),(null==r?void 0:r.allow_upgrades)&&r.percent_off&&"forever"!==r.duration&&(0,o.FD)(d.EY.B5,{color:"secondary",children:[g(j(),Math.floor(r.percent_off),"repeating"===r.duration&&r.duration_in_months?"".concat(r.duration_in_months," months"):"your first payment",D),A]})]})},H=e=>{var t,n,o;let{plan:i,language:r,currency:a,discount:s}=e;return(null==(t=i.metadata)?void 0:t.founding)!=="yes"||s?(0,T.Ac)(i,{language:r,currency:a,discount:s}):null!=(o=null==(n=i.metadata)?void 0:n.short_description)?o:"Founding membership"};var $=n(85478),X=n(12501),ee=n(68349),et=n(41086);let en=e=>{var t,n;let{pub:o,sub:i}=e,r=(0,Z.QP)(o);if(!r)return 0;let a=(0,N.id)(r,i.currency),s=i.is_founding&&i.plan&&(0,Z.Vr)({sub:i})&&r.interval===i.plan.interval?(0,N.id)(i.plan,i.currency):null,l=(0,w.isZeroDecimalCurrency)(null!=(t=i.currency)?t:"usd")?1:100;return(null!=(n=null!=s?s:a)?n:0)/l},eo=e=>{let{pub:t,sub:n}=e,o=null==n?void 0:n.plan;if(!o)return null;if((0,Z.Vr)({sub:n})){let e=(0,Z.QP)(t);if(e&&e.interval===o.interval)return e}return o},ei=e=>{var t,n;let{plan:o,sub:i}=e;return!!o&&!!i.plan&&(!!(o.id===i.plan.id||(0,Z.Vr)({sub:i})&&(0,z.T)({plan:o})&&o.interval===i.plan.interval)||o.amount===i.plan.amount&&o.interval===i.plan.interval&&o.currency===i.plan.currency&&(null==(t=o.metadata)?void 0:t.bitcoin)===(null==(n=i.plan.metadata)?void 0:n.bitcoin))},er=e=>{var t,n,r,p;let{isOpen:_,preselectedPlan:h,pub:y,sub:f,onClose:g}=e,{iString:b,language:C}=(0,s.GO)(),{getConfigFor:P}=(0,$.mJ)(),[S,I]=(0,i.J0)(!1),[A,D]=(0,i.J0)(eo({pub:y,sub:f})),[k,x]=(0,i.J0)(en({pub:y,sub:f})),[F,N]=(0,i.J0)(!1),[E,M]=(0,i.J0)(!1),[B,T]=(0,i.J0)(null),L=(0,i.Kr)(()=>(y.plans||[]).filter(e=>{if(y.disable_annual_subscriptions){var t;return"year"!==e.interval||(null==(t=e.metadata)?void 0:t.founding)}return!y.disable_monthly_subscriptions||"month"!==e.interval}),[y.plans]),q=L.some(e=>{var t;return null==(t=e.metadata)?void 0:t.bitcoin}),O=null!=(n=(0,Z.m4)(y))?n:"",J=null!=(r=f.currency)?r:"usd",U=(0,w.isZeroDecimalCurrency)(J),R=U?1:100,K=A&&!ei({plan:A,sub:f}),G=k!==en({pub:y,sub:f}),j=K||G,H=parseFloat((k*R).toFixed(2))<(null!=(p=(0,Z.fP)({pub:y,currency:J}))?p:0),er=A&&(0,z.T)({plan:A}),ea=er&&G&&(null!=k?k:0)>=(U?1e6:1e4),es=!!(S||!j||ea&&!F||er&&H||B),el=!!(null==A||null==(t=A.metadata)?void 0:t.founding)&&P("founding_plan_upgrade_warning"),{result:ec}=(0,X.st)({pathname:"/api/v1/coupon/one",auto:!!(null==f?void 0:f.is_subscribed)}),eu=null==ec?void 0:ec.coupon;(0,i.vJ)(()=>{if(_&&h){if("yearly"===h){let e=L.find(e=>"year"===e.interval&&1===e.interval_count);e&&D(e)}else if("founding"===h){let e=(0,Z.QP)(y);e&&D(e)}}},[_,L,h,y]);let ed=(0,i.hb)(()=>{D(eo({pub:y,sub:f})),x(en({pub:y,sub:f}))},[y,f]),em=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e&&ed(),(0,v.u4)(v.qY.UPGRADE_PLAN_MODAL_DISMISSED,{plan:A}),g()},ep=async function(){let{quantity:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!A)return;I(!0);let t=k&&er?k*R:void 0;if(ea&&!F)return void I(!1);try{var n;let o=await a().post("/api/v1/subscription/change_plan").send({planId:A.id,foundingAmount:t,quantity:e,token:(0,et.y)(window._preloads.original_url,"token")});(null==(n=o.body)?void 0:n.opennodePaymentUrl)?setTimeout(()=>{window.location.href=o.body.opennodePaymentUrl},30):(I(!1),alert(b("Success! You've changed your plan")),(0,v.u4)(v.qY.UPGRADE_PLAN_MODAL_SUBMITTED,{plan:A,amount:null!=t?t:null,couponId:null==eu?void 0:eu.id}),(0,et.y)("redirect")?(0,ee.V2)((0,et.y)("redirect"),{local_navigation:!1}):((0,ee.qm)("change_plan"),window.location.reload()))}catch(e){I(!1),T((0,ee.uX)(e))}};return L.length?(0,o.FD)("div",{children:[q&&(0,o.Y)(m,{isOpen:E,onContinue:()=>ep()}),(0,o.FD)(u.aF,{isOpen:_,testId:"upgrade-plan-modal",width:700,onClose:S?()=>{}:g,fullscreenMobile:!0,children:[(0,o.Y)(u.rQ,{title:b("Change plan"),onClose:g,showDivider:!0,showClose:!0}),(0,o.FD)(u.cw,{children:[(0,o.FD)(c.pT,{direction:{desktop:"row",mobile:"column"},gap:20,children:[(0,o.Y)(W,{currency:J,foundingAmount:k,foundingName:O,getIsCurrentPlan:e=>ei({plan:e,sub:f}),language:C,plans:L,selectedPlanId:null==A?void 0:A.id,sub:f,coupon:eu,onChangeFoundingAmount:e=>{x(e),T(null),N(!1)},onChangePlan:e=>{let{planId:t}=e,{plans:n}=y,o=null==n?void 0:n.find(e=>e.id===t);o&&((0,v.u4)(v.qY.UPGRADE_PLAN_MODAL_PLAN_CHANGED,{oldPlan:A,newPlan:o,coupon:eu}),D(o),T(null))}}),(0,o.FD)(c.VP,{gap:40,flex:"grow",children:[(0,o.Y)(Q,{currency:J,foundingAmount:k,foundingAmountLessThanMinimum:H,foundingName:O,hasChanges:j,isNewPlanClassicFounding:!!er,newPlan:A,sub:f,coupon:(0,V.Ns)(eu,f,null!=A?A:void 0)?eu:void 0}),ea&&(0,o.Y)(Y,{price:k?k.toString():"",isValid:F,planName:O,currency:J,setValidationState:e=>{N(e),e&&(0,v.u4)(v.qY.FOUNDING_PRICE_CONFIRMATION_SUBMITTED,{price:k,source:"upgrade modal"})},newUpgradeModal:!0}),B&&(0,o.Y)(d.EY,{color:"error",size:14,font:"text",children:B})]})]}),el&&(0,o.Y)(c.pT,{padding:12,children:(0,o.Y)(d.EY.B3,{fontStyle:"italic",translated:!0,children:"Changing plan will charge you a prorated amount based on your current subscription"})})]}),(0,o.Y)(u.jl,{showDivider:!0,primaryButton:(0,o.Y)(l.$n,{priority:"primary",onClick:()=>{var e;(null==A||null==(e=A.metadata)?void 0:e.bitcoin)?(em(!1),M(!0)):ep()},loading:S,disabled:es,children:S?b("Loading..."):b("Change plan")}),secondaryButton:(0,o.Y)(l.$n,{priority:"secondary",onClick:()=>em(),loading:S,children:b("Cancel")})})]})]}):null}},58471:function(e,t,n){n.d(t,{k:()=>_});var o=n(4006),i=n(32485),r=n.n(i),a=n(24142),s=n(84605),l=n(76977),c=n(39318),u=n(98949),d=n(57324),m=n(34372),p=n(80140);let _=e=>{var t,n,i,_;let{user:h,size:y="md"}=e,{iString:f}=(0,s.GO)(),g=(0,u.Fr)(),b=(0,u.aR)(),v=(0,u.m0)(),w=h&&!h.reader_installed_at,Y=g&&(b||v)&&w;return(0,o.FD)(l.fI,{alignItems:"center",justifyContent:"center",gap:8,className:p.A.footerButtons,children:[(0,o.FD)("a",{className:r()(p.A.footerSubstackCta,{[null!=(t=p.A.sizeSm)?t:""]:"sm"===y,[null!=(n=p.A.appUpsell)?n:""]:Y}),native:!0,href:(null==h?void 0:h.has_publication)?"".concat((0,c.$_T)({subdomain:"your"}),"/publish"):"".concat((0,c.Ewe)(),"/signup?").concat((0,c.BpC)({utm_source:d.VU.substack,utm_medium:d.Jn.web,utm_content:d.fL.footer})),children:[(0,o.Y)(a.A,{})," ",f("Start your Substack")]}),!Y&&(0,o.Y)("a",{className:r()(p.A.footerSubstackCta,p.A.getTheApp,p.A.noIcon,{[null!=(i=p.A.sizeSm)?i:""]:"sm"===y,[null!=(_=p.A.sizeSmNoIcon)?_:""]:"sm"===y}),native:!0,href:(0,c.wHz)({utm_campaign:d._9.appMarketing,utm_content:d.fL.webFooterButton}),children:f("Get the app")}),Y&&(0,o.Y)("a",{className:m.A.appBadge,href:(0,c.wHz)({utm_campaign:d._9.appMarketing,utm_content:d.fL.webFooterButton,force:b?"ios":"android"}),children:(0,o.Y)("img",{className:p.A.appUpsell,src:b?(0,c.dJ9)("/img/app_page/app-store.png",320):(0,c.dJ9)("/img/app_page/google-play.png",320)})})]})}},2977:function(e,t,n){n.d(t,{A:()=>es});var o=n(69277),i=n(4006),r=n(32485),a=n.n(r),s=n(69843),l=n.n(s),c=n(98445),u=n(17402),d=n(15734),m=n.n(d),p=n(72170),_=n(82853),h=n(43954),y=n(6505),f=n(60745),g=n(49031),b=n(34581),v=n(70357),w=n(38685),Y=n(9979),C=n(84605),P=n(86500),S=n(35369),I=n(88774),A=n(8295),D=n(49807),k=n(57324);function x(e){let{pub:t,user:n}=e,{iString:o}=(0,C.GO)(),[r,a]=(0,u.useState)(!1),s=(0,D.$_T)(t),l={utm_source:k.VU.navbar,utm_medium:k.Jn.web,r:(null==n?void 0:n.id)?n.id.toString(36):null},c=(0,D.yRP)(s,l),d=async()=>{(0,P.u4)(P.qY.PUBLICATION_SHARE_BUTTON_CLICKED)};return(0,i.FD)(i.FK,{children:[(0,i.FD)(I.W1,{trigger:(0,i.Y)(S.K0,{"aria-label":o("Share Publication"),priority:"tertiary",children:(0,i.Y)(p.A,{size:20})}),onOpen:d,children:[(0,i.FD)(I.H9,{isFirst:!0,children:[(0,i.Y)(I.Dr,{leading:(0,i.Y)(_.A,{}),onClick:()=>{(0,Y.b3)({shareUrl:c,pub:t,utm_campaign:k._9.navbar})},children:o("Copy link")}),(0,i.Y)(I.Dr,{leading:(0,i.Y)(h.A,{}),onClick:()=>{(0,Y.Et)({shareUrl:c,shareName:"Subscribe to ".concat(t.name),pub:t,utm_campaign:k._9.navbar})},children:o("Send as email")}),(0,i.Y)(I.Dr,{leading:(0,i.Y)(y.A,{}),onClick:()=>{(0,P.u4)(P.qY.SHARE_PUBLICATION_MODAL_OPENED),a(!0)},children:o("Get shareable images")})]}),(0,i.FD)(I.H9,{children:[(0,i.Y)(I.Dr,{leading:(0,i.Y)(v.A,{}),onClick:()=>{(0,Y.HT)({shareUrl:c,pub:t,utm_campaign:k._9.navbar})},children:o("Share to Notes")}),(0,i.Y)(I.Dr,{leading:(0,i.Y)(g.A,{}),onClick:()=>{(0,Y.aE)({shareUrl:c,pub:t,utm_campaign:k._9.navbar})},children:o("Share to Facebook")}),(0,i.Y)(I.Dr,{leading:(0,i.Y)(b.A,{}),onClick:()=>{(0,Y.Uy)({shareUrl:c,pub:t,utm_campaign:k._9.navbar})},children:o("Share to Linkedin")}),(0,i.Y)(I.Dr,{leading:(0,i.Y)(f.A,{}),onClick:()=>{(0,Y.PB)({shareUrl:c,shareName:t.name,pub:t,utm_campaign:k._9.navbar})},children:o("Share to Bluesky")}),(0,i.Y)(I.Dr,{leading:(0,i.Y)(w.A,{}),onClick:()=>{(0,Y.NH)({shareUrl:c,shareName:t.name,pub:t,utm_campaign:k._9.navbar})},children:o("Share to X")})]})]}),(0,i.Y)(A.gQ,{pub:t,isOpen:r,setOpen:a,item:{type:"pub_shareable_image"},width:718})]})}var F=n(13950),N=n(45197),E=n(51440),M=n(99145),B=n(53989),T=n(85478),L=n(1683),q=n(76583),O=n(68349),J=n(68410),U=n(17028),V=n(76977),z=n(81203),R=n(51177),W=n(36372),K=n(66511),G=n(38691),Z=n(57934),j=n(40659),Q=n(16291),H=n(56458),$=n(4016),X=n(96301),ee=n(39318),et=n(41086),en=n(82776);let eo=e=>{let{pub:t,dashboardPubs:n}=e,{isMobile:o}=(0,J.sM)(),{iString:r}=(0,C.GO)(),{onOpen:a,onClose:s}=(0,F.xF)();return(0,i.Y)(R.q7,{priority:"secondary",size:o?"sm":"md",additionalMenuProps:{onOpen:a,onClose:s},menuItems:n.map(e=>(0,i.Y)(I.Dr,{native:!0,href:(0,D.Z96)(e,{addBase:!0,params:{utm_source:k.VU.substack,utm_content:k.fL.dashboardPubSwitcher}}),leading:(0,i.Y)(z.Nq,{size:24,radius:"xs",logoUrl:e.logo_url}),priority:t.subdomain===e.subdomain?"selected":"primary",children:e.name},e.id)),href:(0,D.Z96)(t,{addBase:!0}),localNavigation:!1,"data-testid":"menu-dashboard-button",children:r("Dashboard")})};function ei(){let{iString:e}=(0,C.GO)(),t=(0,M.v9)();return(0,i.Y)(K.m_,{text:e("Search"),side:"bottom",children:(0,i.Y)(U.K0,{priority:"tertiary",onClick:()=>t.open(),children:(0,i.Y)(c.A,{size:20})})})}let er=e=>{let{dashboardPubs:t,pub:n}=e,{iString:o}=(0,C.GO)(),{isMobile:r}=(0,J.sM)();return t.length>1?(0,i.Y)(eo,{pub:n,dashboardPubs:t}):(0,i.Y)(U.$n,{size:r?"sm":"md",priority:"secondary",href:(0,D.Z96)(n,{addBase:!0}),"data-testid":"menu-dashboard-button",localNavigation:!1,children:o("Dashboard")})};function ea(e){var t,n,r,a,s,c,u,d,p,_,h;let{user:y,pub:f,freeSignup:g,freeSignupEmail:b,hide_subscribe_cta:v,isMeetingsActive:w,siteConfigContext:Y,getSettingFor:C,renewing:S,renewed:I,setToRenew:A,language:x,isMobile:F}=e,{iString:N,iPlural:E}=I18N.i(x);f.invite_only&&!((null==y?void 0:y.subscription_id)||(null==y?void 0:y.is_free_subscribed))&&(v=!0);let M=(0,j.rG)(),B=null==y?void 0:y.is_contributor,T=(null==y?void 0:y.is_subscribed)||B,q=(null==y?void 0:y.is_free_subscribed)||g,J=H.zN(f)&&T&&["gift","comp"].includes(null!=(a=y.subscription_type)?a:"")&&!(0,X.ZA)({pub:f,subscriptionType:null==y?void 0:y.subscription_type})&&(0,Q.A)(y.subscription_expiry).subtract(30,"days").isBeforeNow(),V=H.zN(f)&&y&&H.cK(y)&&y.comp_expired_recently,z=(null==y?void 0:y.is_free_subscribed)&&(null==y?void 0:y.is_paused),R=(null==y?void 0:y.subscription_type)==="ios_app";if(B){let e=(null==y?void 0:y.dashboard_pubs)||[];return(0,i.Y)(er,{dashboardPubs:e,pub:f})}if(z)return(0,i.Y)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"unpause-subscription"}),(0,O.V2)((0,ee._nG)(f,{addBase:!0}),{local_navigation:!1})},children:N("Unpause my subscription")});if(J||V){if(!v)return(0,i.FD)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{var e;(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"continue-support"}),(0,O.V2)((0,ee.eV6)(f,{utm_source:k.VU.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,et.y)("referring_pub_ids"),addBase:!0,selectedPlanId:J&&(null==y?void 0:y.is_founding)&&f.plans?null==(e=f.plans.find(e=>{var t;return null==(t=e.metadata)?void 0:t.founding}))?void 0:e.id:null}),{local_navigation:!1})},children:[(0,i.Y)("span",{className:"mobile-only",children:N("Subscribe")}),(0,i.Y)("span",{className:"desktop-only",children:N("Continue your support")})]})}else if(H.zN(f)&&q&&!T&&!["thebulwark"].includes(f.subdomain)){if(!v)return(0,i.Y)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"upgrade-subscription"}),(0,O.V2)((0,ee.eV6)(f,{utm_source:k.VU.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,et.y)("referring_pub_ids"),addBase:!0}),{local_navigation:!1})},children:(0,en.getSubscribeText)(f,{isFreeSubscribed:!0,isMobile:(0,O.rr)(),language:x})})}else if(H.zN(f)?T:q||T){if(f.invite_only&&T&&!l()(y.invites)&&y.invites<f.subscriber_invites)return(0,i.Y)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"invite"}),(0,O.V2)((0,ee.n_I)(f),{local_navigation:!1})},children:(0,i.Y)("span",{children:E("1 invite left","%1 invites left",f.subscriber_invites-y.invites)})});else if(H.zN(f)&&w&&Y&&!Y.getConfigFor("hide_book_a_meeting_button"))return(0,i.FD)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"book-meeting"}),(0,O.V2)((0,D.SJN)(f,{params:{source:"navbar-cta"},referrer:"undefined"!=typeof window?window.location.href:void 0}),{local_navigation:!1})},children:[(0,i.Y)("span",{className:"mobile-only",children:N("Book meeting")}),(0,i.Y)("span",{className:"desktop-only",children:N("Book a meeting")})]});else if(H.zN(f)&&y&&y.is_subscribed&&!R&&y.subscription_unsubscribed_at&&!["gift","comp"].includes(null!=(s=y.subscription_type)?s:""))return(0,i.FD)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"renew"}),A()},disabled:S||I,style:{visibility:I?"hidden":"visible"},children:[(0,i.Y)("span",{className:"mobile-only",children:N("Renew")}),(0,i.Y)("span",{className:"desktop-only",children:N("Renew subscription")})]})}else if(!v){let e=null==(d=(0,et.y)("referring_pub_ids"))||null==(u=d.split)||null==(c=u.call(d,","))?void 0:c[0],t=null==(h=(0,et.y)("referring_pub_ids"))||null==(_=h.split)||null==(p=_.call(h,","))?void 0:p.slice(1);return(0,i.Y)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:async()=>{let n=y&&!y.is_magic&&y.email||b;if((0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"free-subscription",homepage_type:f.homepage_type}),n){let i;try{let r=await m().post("/api/v1/free").send((0,o._)({source:"menu",email:n,first_url:L.R9,first_referrer:L.b7,current_url:L.AT,current_referrer:L.uC,first_session_url:L.K0,first_session_referrer:L.OG,referring_pub_id:e,additional_referring_pub_ids:t},M));i=r.body.referral_token,(0,P.$5)(r.body.requires_confirmation)}catch(e){(0,P.u4)(P.qY.FREE_SIGNUP_FAILED,{reason:e.message,source:"menu"})}window.location.href=(0,ee.eV6)(f,{utm_source:k.VU.menu,simple:!0,next:document.location.href,skip_redirect_check:!0,just_signed_up:!0,addBase:!0,referral_token:i})}else window.location.href=(0,ee.eV6)(f,{utm_source:k.VU.menu,simple:!0,next:document.location.href,referring_pub_ids:(0,et.y)("referring_pub_ids"),addBase:!0})},children:(0,en.getSubscribeText)(f,{isFreeSubscribed:q,isMobile:(0,O.rr)(),language:x})})}let W=(null==f||null==(r=f.plans)||null==(n=r.find(e=>{var t;return null==(t=e.metadata)?void 0:t.founding}))||null==(t=n.metadata)?void 0:t.short_description)==="Founding Member";if(H.zN(f)&&y&&!y.is_founding&&!R&&(0,Q.A)(y.subscription_first_payment_at).isBefore((0,Q.A)().subtract(48,"hours"))&&((0,$.s7)({pub:f})||"pinespayments"===f.subdomain||"citrini"===f.subdomain||W)){let e=(0,D.RKl)({pub:f,user:y,params:{utm_source:k.VU.menu,next:document.location.href}});return(0,i.FD)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"founding-upgrade"}),(0,O.V2)(e,{local_navigation:!1})},children:[(0,i.Y)("span",{className:"mobile-only",children:N("Upgrade")}),(0,i.Y)("span",{className:"desktop-only",children:N(W?"Upgrade to founding":"Upgrade")})]})}return"disabled"===f.payments_state&&!f.invite_only&&C("payment_pledges_enabled")&&q&&!(null==y?void 0:y.is_pledged)?(0,i.Y)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"pledge-subscription"}),(0,O.V2)((0,ee.eV6)(f,{utm_source:k.VU.menu,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:N("Pledge your support")}):H.zN(f)&&!f.invite_only?(0,i.FD)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"gift-subscription"}),(0,O.V2)(y&&(null==Y?void 0:Y.getConfigFor("enable_founding_gifts"))?(0,$.eh)({user:y}):(0,ee.eV6)(f,{utm_source:k.VU.menu,gift:!0,next:document.location.href,addBase:!0}),{local_navigation:!1})},children:[(0,i.Y)("span",{className:"mobile-only",children:N("Give gift")}),(0,i.Y)("span",{className:"desktop-only",children:N("Gift a subscription")})]}):!f.is_on_substack||(null==y?void 0:y.has_publication)?null:(0,i.Y)(U.$n,{"data-testid":"noncontributor-cta-button",size:F?"sm":"md",onClick:()=>{(0,P.u4)(P.qY.NAV_BAR_CTA_CLICKED,{type:"start-publishing"}),(0,O.V2)((0,ee.f5H)({utm_source:k.VU.menu}),{local_navigation:!1})},children:N("Start publishing")})}let es=e=>{let{className:t,fixedTooltip:n=!0,freeSignup:o,freeSignupEmail:r,hideCta:s,hideNotifications:l,hideChat:c,hideSearch:d,hideShare:p,hideUserIndicator:_,hide_subscribe_cta:h,isMeetingsActive:y,pub:f,showCustomerSupportModeModal:g,user:b}=e,{iString:v,language:w}=(0,C.GO)(),{isMobile:Y}=(0,J.sM)(),{getSettingFor:P}=(0,B.Pu)(),[S,I]=(0,u.useState)(!1),[A,D]=(0,u.useState)(!1),k=(0,W.d)(),{enableCustomerServiceMode:F,disableCustomerServiceMode:M,modalElement:L}=(0,q.UU)({showCustomerSupportModeModal:g}),U=async()=>{I(!0);try{await m().post("/api/v1/subscription/reactivate").send({}),D(!0),k.popToast(()=>(0,i.Y)(W.y,{text:v("Your subscription has been renewed!")}))}catch(e){console.error("Failed to set to renew:",e),alert((0,O.uX)(e))}finally{I(!1)}};return(0,i.FD)(V.Ye,{alignItems:"center",gap:Y?4:8,className:a()("navbar-buttons",t),justifyContent:"end",children:[(0,i.Y)(T.W8.Consumer,{children:e=>(0,i.Y)(E.U6.Consumer,{children:t=>(0,i.FD)(i.FK,{children:[!Y&&!b&&(0,i.FD)(V.Ye,{gap:4,children:[!d&&(0,i.Y)(ei,{}),!p&&(0,i.Y)(x,{pub:f,user:null!=b?b:void 0})]}),!Y&&b&&(0,i.FD)(V.Ye,{gap:4,children:[!d&&(0,i.Y)(ei,{}),c?!p&&(0,i.Y)(x,{pub:f,user:b}):(0,i.Y)(G.a,{}),!l&&(0,i.Y)(Z.S,{canShowAlerts:!f})]}),!s&&(0,i.Y)(ea,{pub:f,user:b,freeSignup:o,freeSignupEmail:r,hide_subscribe_cta:h,localeContext:t,siteConfigContext:e,isMeetingsActive:y,getSettingFor:P,renewing:S,renewed:A,setToRenew:U,language:w,isMobile:Y}),!_&&(0,i.Y)(N.Ay,{pub:f,user:b,enableCustomerServiceMode:F,disableCustomerServiceMode:M,fixedTooltip:n})]})})}),L]})}},85048:function(e,t,n){n.d(t,{Gf:()=>_,Nf:()=>u,qd:()=>c});var o=n(4006),i=n(41196),r=n(84605),a=n(63136),s=n(80856);function l(e,t){return[...Array(2*e.length-1)].map((n,o)=>o%2?t:e[o/2])}let c=e=>{let{publication:t,className:n,themed:i=!1,utm_source:r}=e,a=i?"pub-tertiary-text":"tertiary";switch(null==t?void 0:t.subdomain){case"activisionblizzard":return(0,o.Y)(m,{className:n,color:a,utm_source:r});case"demographyunplugged":return(0,o.Y)(p,{className:n,color:a,utm_source:r});default:return(0,o.Y)(d,{pub:t,className:n,color:a,utm_source:r})}},u=e=>{let{publication:t}=e,{iString:n}=(0,r.GO)();if((null==t?void 0:t.subdomain)==="demographyunplugged")return(0,o.FD)(o.FK,{children:[(0,o.FD)(a.EY,{translated:!0,size:14,className:"tos",children:["Substack's ",(0,o.Y)(i.o,{href:(0,s.gB)(),children:"Privacy"}),","," ",(0,o.Y)(i.o,{href:(0,s.lk)(),children:"Terms"})," and"," ",(0,o.Y)(i.o,{href:(0,s.iQ)(),children:"Information Collection Notice"})]}),(0,o.FD)(a.EY,{translated:!0,size:14,className:"tos",children:["Demography Unplugged's"," ",(0,o.Y)(i.o,{href:"https://www.demographyunplugged.com/p/privacy-policy",children:"Privacy"})," and"," ",(0,o.Y)(i.o,{href:"https://www.demographyunplugged.com/p/terms-of-service",children:"Terms"})]})]});let c=[(0,o.Y)(i.o,{href:(0,s.gB)(),children:n("Privacy")}),(0,o.Y)(i.o,{href:(0,s.lk)(),children:n("Terms")}),(0,o.Y)(i.o,{href:(0,s.iQ)(),children:n("Collection notice")})];return(null==t?void 0:t.subdomain)==="activisionblizzard"&&c.push((0,o.FD)(o.FK,{children:["Activision's"," ",(0,o.Y)(i.o,{href:"https://www.activisionblizzard.com/legal/privacy-policy",children:"Privacy Policy"})]})),(null==t?void 0:t.subdomain)==="demographyunplugged"&&(c.push((0,o.FD)(o.FK,{children:["Demography Unplugged's"," ",(0,o.Y)(i.o,{href:"https://www.demographyunplugged.com/p/privacy-policy",children:"Privacy Policy"})]})),c.push((0,o.FD)(o.FK,{children:["Demography Unplugged's"," ",(0,o.Y)(i.o,{href:"https://www.demographyunplugged.com/p/terms-of-service",children:"Terms"})]}))),(0,o.Y)(o.FK,{children:l(c,(0,o.Y)("span",{children:" ∙ "}))})},d=e=>{let{pub:t,className:n,color:r,utm_source:l}=e,c=null;return t.has_custom_tos&&t.has_custom_privacy?c=(0,o.FD)(a.EY.B4,{as:"span",translated:!0,children:["the publisher's ",(0,o.Y)(i.o,{href:(0,s.Ru)({pub:t,utm_source:l}),children:"Terms of Service"})," and"," ",(0,o.Y)(i.o,{href:(0,s._)({pub:t,utm_source:l}),children:"Privacy Policy"})]}):t.has_custom_tos?c=(0,o.FD)(a.EY.B4,{as:"span",translated:!0,children:["the publisher's ",(0,o.Y)(i.o,{href:(0,s.Ru)({pub:t,utm_source:l}),children:"Terms of Service"})]}):t.has_custom_privacy&&(c=(0,o.FD)(a.EY.B4,{as:"span",translated:!0,children:["the publisher's ",(0,o.Y)(i.o,{href:(0,s._)({pub:t,utm_source:l}),children:"Privacy Policy"})]})),(0,o.Y)(a.EY.B4,{color:r,className:null!=n?n:"tos",children:(0,o.Y)(i.b,{publisherTerms:c,utm_source:l})})},m=e=>{let{className:t,color:n,utm_source:r}=e;return(0,o.FD)(a.EY.B3,{translated:!0,size:14,color:n,className:null!=t?t:"tos",children:["By registering you agree to Substack's"," ",(0,o.Y)(i.o,{href:(0,s.lk)({utm_source:r}),children:"Terms of Service"}),", our"," ",(0,o.Y)(i.o,{href:(0,s.gB)({utm_source:r}),children:"Privacy Policy"}),", our"," ",(0,o.Y)(i.o,{href:(0,s.iQ)({utm_source:r}),children:"Information Collection Notice"}),", and Activision's"," ",(0,o.Y)(i.o,{href:"https://www.activisionblizzard.com/legal/privacy-policy",children:"Privacy Policy"})]})},p=e=>{let{className:t,color:n,utm_source:r}=e;return(0,o.FD)("div",{className:null!=t?t:"tos",children:[(0,o.FD)(a.EY.B3,{translated:!0,size:14,color:n,children:["By registering you agree to Substack's"," ",(0,o.Y)(i.o,{href:(0,s.lk)({utm_source:r}),children:"Terms of Service"}),", our"," ",(0,o.Y)(i.o,{href:(0,s.gB)({utm_source:r}),children:"Privacy Policy"}),", our"," ",(0,o.Y)(i.o,{href:(0,s.iQ)({utm_source:r}),children:"Information Collection Notice"}),"."]}),(0,o.FD)(a.EY.B3,{translated:!0,size:14,color:n,children:["You also agree to receive marketing emails from Hedgeye Risk Management, LLC pursuant to its"," ",(0,o.Y)(i.o,{href:"https://www.demographyunplugged.com/p/privacy-policy",children:"Privacy Policy"})," and"," ",(0,o.Y)(i.o,{href:"https://www.demographyunplugged.com/p/terms-of-service",children:"Terms of Service"}),"."]}),(0,o.Y)(a.EY.B3,{translated:!0,size:14,color:n,children:"You may unsubscribe at any time by clicking the unsubscribe link in one of the emails."})]})},_=e=>{let{pub:t}=e,n=[];return t.has_custom_privacy&&n.push((0,o.Y)(i.o,{href:(0,s._)({pub:t}),children:"Publisher Privacy"})),t.has_custom_tos&&n.push((0,o.Y)(i.o,{href:(0,s.Ru)({pub:t}),children:"Publisher Terms"})),(0,o.Y)(o.FK,{children:l(n,(0,o.Y)("span",{children:" ∙ "}))})}},51419:function(e,t,n){n.d(t,{WJ:()=>l,eG:()=>c});var o=n(4006),i=n(17402);let r={name:null,version:null,major:null},a={chrome:130,firefox:130,safari:16,edge:130},s=(0,i.createContext)({browser:r,isSupported:!0,webviewPlatform:null});function l(e){let{browser:t=r,webviewPlatform:n=null,children:l}=e,c=(0,i.useMemo)(()=>{let{name:e,version:o,major:i}=t,r=!0,s=a[null==e?void 0:e.toLowerCase()];return e&&s&&(r=!!(o&&i&&Number(i)>=s)),{browser:t,isSupported:r,webviewPlatform:n}},[t,n]);return(0,o.Y)(s.Provider,{value:c,children:l})}function c(){return(0,i.useContext)(s)}},89195:function(e,t,n){n.d(t,{w:()=>_});var o=n(4006),i=n(32485),r=n.n(i),a=n(17402),s=n(58471),l=n(23044);n(73164);var c=n(56778);n(84605);var u=n(98747),d=n(86500),m=n(63136),p=n(39318);n(80856);let _=(0,a.memo)(e=>{let{publication:t,user:n,path:i,hideTerms:a,showIntrinioAttrib:l}=e;void 0===a&&(a=!1);let _=(0,u.oY)();return(0,o.FD)("div",{className:"footer-wrap publication-footer",children:[(0,o.Y)(c.A,{onVisible:()=>{var e;(0,d.u4)(d.qY.PUBLICATION_FOOTER_SEEN,{publication_id:null==t?void 0:t.id,user_id:null==n?void 0:n.id,source:(e=i)?"/"===e?"pub-homepage":e.startsWith("/p")?"pub-post":e:"unknown"})}}),(0,o.Y)("div",{className:r()("footer",{"themed-background":_}),children:(0,o.FD)("div",{className:"container",children:[(0,o.Y)(h,{pub:t,hideTerms:a,showIntrinioAttrib:null!=l&&l}),(0,o.Y)(s.k,{user:n}),(0,o.FD)(m.EY,{translated:!0,as:"div",className:"footer-slogan-blurb",children:[(0,o.Y)("a",{href:"".concat((0,p.Ewe)()),native:!0,children:"Substack"})," ","is the home for great culture"]})]})})]})}),h=e=>{let{pub:t,hideTerms:n,showIntrinioAttrib:i}=e;return(0,l.PG)(t)?(0,o.FD)("div",{className:"footer-terms",children:[(0,o.FD)("div",{className:"footer-terms-row",children:[(0,o.Y)(l.d_,{pub:t}),!n&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.P0,{pub:t})]})]}),(0,o.FD)("div",{className:"footer-terms-row",children:[(0,o.Y)("span",{children:"Substack"}),i&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.kz,{})]}),!n&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.vA,{pub:t})]})]})]}):(0,o.FD)("div",{className:"footer-terms",children:[(0,o.Y)(l.d_,{pub:t}),i&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.kz,{})]}),!n&&(0,o.FD)(o.FK,{children:[(0,o.Y)("span",{children:" \xb7 "}),(0,o.Y)(l.vA,{pub:t})]})]})}},62668:function(e,t,n){n.d(t,{d:()=>o});let o=(0,n(17402).createContext)(!1)},94328:function(e,t,n){n.d(t,{LM:()=>f,b_:()=>b,u8:()=>g});var o=n(4006),i=n(87677),r=n(17402),a=n(32999),s=n(84605),l=n(27749),c=n(2675),u=n(67024),d=n(75840),m=n(68349),p=n(75303),_=n(81929),h=n(504),y=n(8791);let f=()=>{let{iString:e}=(0,s.GO)();return(0,o.Y)(_.vw,{theme:"error",priority:"primary",className:y.A.livePill,children:e("LIVE")})},g=e=>{let{viewerCount:t}=e;return(0,o.Y)(_.Jq,{priority:"primary",leading:(0,o.Y)(a.A,{size:18}),children:(0,u.q)(t)})},b=e=>{let{item:t,pub:n,post:a,onViewEpisodeClick:u}=e,{iString:p}=(0,s.GO)(),y=(0,c.vZ)({post:a,publication:n,urlParams:{autoPlay:"true"}}),f=(0,l.PK)(),g=(0,r.useContext)(d.P);return(0,o.Y)(_.Jq,{priority:"primary",onClick:e=>{null===m.dO||void 0===m.dO||m.dO.emit("play",{}),t&&(0,h.Qb)(t,f,"watch_full_episode",{tabId:g}),null==u||u(),y(e)},trailing:(0,o.Y)(i.A,{size:16}),children:p("View full episode")})};(0,p.I4)({display:"flex",direction:"row",gap:8,alignItems:"center",className:y.A.viewerCountContainer})},3479:function(e,t,n){n.d(t,{j2:()=>l});var o=n(86500);let i=["sort"],r=["sort","selection"],a=[];function s(e,t){let n;try{n=new URL("".concat(location.protocol,"//").concat(location.host).concat(e))}catch(t){n=new URL(e)}for(let e of n.searchParams.keys())(t?r:i).includes(e)||n.searchParams.delete(e);return n.toString()}function l(e){setTimeout(()=>(function(e){var t,n;let{previous:i,url:r}=e;if("undefined"==typeof window)return;let l=s(r,!1),c=s(r,!0),{head:u}=document;null==(t=u.querySelector("link[rel=canonical]"))||t.setAttribute("href",l),null==(n=u.querySelector('meta[property="og:url"]'))||n.setAttribute("content",c),a.push(r),setTimeout(()=>{(0,o.YT)({previous:i,url:r})},100)})(e),0)}},76583:function(e,t,n){n.d(t,{UU:()=>p});var o=n(4006),i=n(17402),r=n(36339),a=n(25006),s=n(46271),l=n(94729),c=n(68349),u=n(16993),d=n(39318),m=n(41086);function p(){var e;let{showCustomerSupportModeModal:t,allowAllDay:n,allowClose:p}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_=(0,a.df)(),h=(0,s.Jd)(),{canTurnOnCustomerSupportMode:y,isInCustomerSupportMode:f}={canTurnOnCustomerSupportMode:!!(null==(e=(0,s.Jd)())?void 0:e.is_global_admin)&&!(null==e?void 0:e.is_admin),isInCustomerSupportMode:!!(null==e?void 0:e.is_global_admin)&&!!(null==e?void 0:e.is_admin)&&!(null==e?void 0:e.is_author)},[g,b]=(0,i.useState)(!!(t&&y)),v=async()=>{try{await (0,l.x6)("/api/v1/customer_support_mode",{method:"DELETE"}),document.location.href="/"}catch(e){alert((0,c.uX)(e))}},w=async()=>{if(null==_?void 0:_.custom_domain){let e=window.location.pathname;(0,c.V2)((0,d.oMA)(e,_),{local_navigation:!1})}else b(!0)},Y=y&&(0,o.Y)(u.aF,{isOpen:g,onClose:p?()=>b(!1):void 0,children:(0,o.Y)(r.A,{redirect:(0,m.y)("redirect")||"/publish/home",onClose:()=>b(!1),requiresMfa:null==h?void 0:h.requires_global_admin_mfa_challenge,allowAllDay:n,allowClose:p})});return{enableCustomerServiceMode:y?w:void 0,disableCustomerServiceMode:f?v:void 0,modalElement:Y}}},51190:function(e,t,n){n.d(t,{X:()=>F});var o=n(4006),i=n(32485),r=n.n(i),a=n(24713),s=n.n(a),l=n(33031),c=n.n(l),u=n(48635),d=n(33764),m=n(84605),p=n(86500),_=n(68410),h=n(89490),y=n(35369),f=n(76977),g=n(63136),b=n(49807);let v=e=>{var t;let{label:n,openInNewTab:i,podcastSettings:a,section:s,sectionUrl:l,setupUrl:c,subscribeUrl:v,trackingSource:w,user:C}=e,{iString:P}=(0,m.GO)(),{isMobile:S}=(0,_.sM)(),I=S?80:160,A=(0,h.iF)({radius:"md",width:I}),D=(null==C?void 0:C.is_subscribed)&&null!=(t=a.paidEpisodeArtUrl)?t:a.artUrl;return(0,o.FD)(f.Ye,{direction:S?"column":"row",gap:S?12:24,children:[D&&(0,o.Y)(d.o,{className:r()(A),src:(0,b.dJ9)(D,2*I),maxWidth:I,useRetinaSizing:!0,imageIsFixedWidth:!0}),(0,o.FD)(f.I1,{gap:8,children:[(0,o.FD)(f.Ye,{alignItems:"center",justifyContent:"space-between",children:[(0,o.Y)(g.EY.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",weight:"bold",href:l,rel:"noopener noreferrer",target:"_blank",children:a.title}),c&&(0,o.Y)(y.$n,{priority:"secondary",size:"sm",href:c,newTab:i,onClick:()=>{(0,p.u4)(p.qY.SET_UP_FEED_CLICKED,{section_id:s.id,source:w})},children:P("Set up")})]}),n&&(0,o.FD)(f.Ye,{gap:8,alignItems:"center",children:[(0,o.Y)(Y,{label:n}),"free-with-ads"===n&&v&&(0,o.Y)(g.EY,{className:"listenLink-UqdzU4",color:"accent",font:"text",size:12,onClick:()=>{(0,p.u4)(p.qY.LISTEN_AD_FREE_CLICKED,{section_id:s.id,source:w}),i?window.open(v,"_blank","noopener,noreferrer"):window.location.href=v},children:"Listen ad-free"})]}),(0,o.Y)(g.EY.B3,{color:"pub-secondary-text",font:"text",children:a.description}),(0,o.Y)("div",{children:(0,o.FD)(g.EY,{alignItems:"center",color:"accent",display:"inline-flex",font:"text",size:14,weight:"medium",gap:8,onClick:()=>{(0,p.u4)(p.qY.SEE_ALL_EPISODES_CLICKED,{section_id:s.id,source:w}),i?window.open(l,"_blank","noopener,noreferrer"):window.location.href=l},children:[(0,o.Y)("span",{children:P("See all episodes")}),(0,o.Y)(u.A,{size:14})]})})]})]})},w=e=>{let{label:t,openInNewTab:n,podcastSettings:i,section:a,sectionUrl:s,trackingSource:l}=e,{iString:c}=(0,m.GO)(),_=(0,h.iF)({radius:"md"});return(0,o.FD)(f.I1,{className:"containerVertical-L_u6LQ",border:"detail-themed",padding:20,radius:"md",gap:20,children:[(0,o.Y)(f.Ye,{justifyContent:"center",children:i.artUrl&&(0,o.Y)(d.o,{className:r()(_,"logoVertical-p9LsNy"),src:(0,b.dJ9)(i.artUrl,440),maxWidth:164,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,o.FD)(f.I1,{gap:12,children:[(0,o.FD)(f.I1,{gap:8,children:[(0,o.Y)(g.EY.B1,{as:"a",color:"pub-primary-text",font:"pub-headings",href:s,rel:"noopener noreferrer",target:"_blank",weight:"bold",children:i.title}),t&&(0,o.Y)(f.Ye,{children:(0,o.Y)(Y,{label:t})}),(0,o.Y)(g.EY.B3,{color:"pub-secondary-text",font:"text",children:i.description})]}),(0,o.Y)("div",{children:(0,o.FD)(g.EY,{display:"inline-flex",alignItems:"center",gap:8,color:"accent",font:"text",size:14,weight:"medium",onClick:()=>{(0,p.u4)(p.qY.SEE_ALL_EPISODES_CLICKED,{section_id:a.id,source:l}),n?window.open(s,"_blank","noopener,noreferrer"):window.location.href=s},children:[(0,o.Y)("span",{children:c("See all episodes")}),(0,o.Y)(u.A,{size:14})]})})]})]})},Y=e=>{let{label:t}=e;return(0,o.Y)(f.Ye,{bg:"secondary",display:"inline-block",paddingX:6,radius:"sm",children:(0,o.Y)(g.EY,{color:"pub-secondary-text",font:"text",size:12,weight:"semibold",lineHeight:20,children:"member-only"===t?"+ Member-only":"free-with-ads"===t?"Free with ads":"Free"})})};var C=n(20562),P=n(12592),S=n(56458),I=n(4016),A=n(46009),D=n(39318),k=n(41086);let x=n(57324).VU.podcastsPage,F=e=>{let{idToMagicLink:t,pub:n,user:i}=e,{isMobile:a}=(0,_.sM)(),l=c()((0,S.th)(n),e=>{var t;return null!=(t=s()(n.navigationBarItems,t=>t.section_id===e.id))?t:999}),u=!!(null==i?void 0:i.is_subscribed),d=!u&&!a,m=l.filter(e=>u||!(0,I.dm)({sectionId:e.id})),p=u?[]:l.filter(e=>(0,I.dm)({sectionId:e.id})),h=null==t?void 0:t[n.id];return h||(h=(0,D.wpu)(n,{section:null,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:x}})),(0,o.Y)(P.c,{columns:d?3:2,paddingTop:a?8:void 0,children:(0,o.FD)(f.pT,{className:r()({"twoColumnGrid-pq1MC7":d}),direction:d?"row":"column",gap:d?void 0:40,children:[!u&&(0,o.FD)(f.I1,{alignItems:a?"stretch":"start",className:"sideColumn-FFh4jo",gap:24,paddingLeft:d?32:void 0,children:[(0,o.FD)(f.I1,{gap:a?12:16,children:[(0,o.Y)(g.EY.H2,{color:"pub-primary-text",font:"pub-headings",children:"Member-only Shows"}),(0,o.Y)(C.t,{firehoseFeedUrl:h,pub:n,trackingSource:x,variant:"member-only"})]}),(0,o.Y)(f.I1,{gap:a?16:24,children:p.map((e,r)=>{let s=(0,A.lL)({pub:n,section:e}),l=(null==t?void 0:t[e.id])||(0,D.wpu)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:x}}),c=(0,b.Dor)(n,{section:e,addBase:!0}),d=(0,I.rD)({sectionId:e.id})?"member-only":"free";return(0,o.FD)(o.FK,{children:[(0,o.Y)(a?v:w,{label:d,openInNewTab:!0,podcastSettings:s,section:e,sectionUrl:c,setupUrl:u?l:null,trackingSource:x,user:null!=i?i:null}),r!==p.length-1&&a&&(0,o.Y)(f.Ye,{borderBottom:"detail-themed"})]})})})]}),(0,o.FD)(f.I1,{className:"mainColumn-cft5kf",gap:24,paddingRight:d?32:void 0,children:[(0,o.FD)(f.I1,{gap:a?12:16,children:[(0,o.FD)(g.EY.H2,{color:"pub-primary-text",font:"pub-headings",children:[n.name," Shows"]}),u&&(0,o.Y)(C.t,{pub:n,firehoseFeedUrl:h,trackingSource:x})]}),(0,o.Y)(f.I1,{gap:a?16:24,children:m.map((e,r)=>{let a=(0,A.lL)({pub:n,section:e}),s=(null==t?void 0:t[e.id])||(0,D.wpu)(n,{section:e,noSection:!1,addBase:!0,user:null,startAtSubscribeFlow:!i||!i.is_free_subscribed,params:{utm_source:x}}),l=(0,b.Dor)(n,{section:e,addBase:!0}),c=(0,I.rD)({sectionId:e.id})?u?"member-only":"free-with-ads":"free";return(0,o.FD)(o.FK,{children:[(0,o.Y)(v,{label:c,openInNewTab:!0,podcastSettings:a,section:e,sectionUrl:l,setupUrl:u?s:null,subscribeUrl:(0,D.eV6)(n,{utm_source:x,simple:!0,next:document.location.href,referring_pub_ids:(0,k.y)("referring_pub_ids"),addBase:!0}),trackingSource:x,user:null!=i?i:null}),r!==m.length-1&&(0,o.Y)(f.Ye,{borderBottom:"detail-themed"})]})})})]})]})})}},72216:function(e,t,n){n.d(t,{E:()=>d,p:()=>p});var o=n(4006),i=n(84605),r=n(35369),a=n(33727),s=n(76977),l=n(81203),c=n(63136),u=n(39318);let d=(e,t)=>{var n;return{logoUrl:e.podcast_art_url||e.logo_url||(0,u.yX_)(),mainClickUrl:(0,u.t6y)({pub:e,section:null,addBase:!0}),buttonClickUrl:t,name:e.podcast_title||e.name,description:null!=(n=e.podcast_description||e.hero_text)?n:void 0}},m=e=>{let{logoUrl:t,mainClickUrl:n,buttonClickUrl:u,name:d,description:m,showButton:p}=e,{iString:_}=(0,i.GO)();return(0,o.FD)(a.Z,{gap:12,direction:"row",alignItems:"center",padding:12,children:[t&&(0,o.Y)(l.Nq,{size:48,logoUrl:t}),(0,o.FD)(s.VP,{gap:2,flex:"grow",children:[(0,o.Y)(c.EY.B3,{weight:"semibold",children:(0,o.Y)(c.Yq,{href:n,children:d})}),(0,o.Y)(c.EY.B4,{color:"secondary",children:m})]}),p&&(0,o.Y)(r.$n,{priority:"primary",href:u,newTab:!0,children:_("Set up")})]})},p=e=>{let{showButton:t,items:n}=e;return(0,o.Y)(s.VP,{gap:12,children:n.map(e=>(0,o.Y)(m,{logoUrl:e.logoUrl,mainClickUrl:e.mainClickUrl,buttonClickUrl:e.buttonClickUrl,name:e.name,description:e.description,showButton:t}))})}},38804:function(e,t,n){n(17402)},95436:function(e,t,n){n.d(t,{T:()=>s}),n(4006);var o=n(63950),i=n.n(o),r=n(17402);n(38804),n(71783);let a=(0,r.createContext)({activatePreviewBlock:i(),activeContentBlockId:null,activePreviewBlockId:null,deactivatePreviewBlock:i(),getBehavior:()=>({clickAction:"activate",showOverlay:!0}),hasChanges:!1,hasReceivedInitialPreviewUIState:!1,isActive:()=>!1,isMobileEditor:!1,isPreviewingSidebarModuleInsertion:!1,isPreviewMode:!1,requestBlockPicker:i(),requestModulePicker:i(),sendPreviewBlockUpdate:i(),sendSidebarModuleRemove:i(),sendThemePropertyDragEnd:i()}),s=()=>(0,r.useContext)(a)},57934:function(e,t,n){n.d(t,{S:()=>Y,X:()=>C});var o=n(4006),i=n(32485),r=n.n(i),a=n(49436),s=n(17402),l=n(84605),c=n(97640),u=n(86500),d=n(12501),m=n(89490),p=n(35369),_=n(76977),h=n(37598),y=n(66511),f=n(11710),g=n(91324),b=n(21398),v=n(15663),w=n(61060);function Y(e){var t,i;let{canShowAlerts:r=!1}=e,{iString:_}=(0,l.GO)(),w=(0,c.Vd)(),[Y,P]=(0,s.useState)(!1),S=(0,d.st)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1}),I=(0,d.st)({pathname:"/api/v1/live_streams",query:{status:"scheduled",stream_type:"all"},auto:!1}),A=null!=(i=null==(t=I.result)?void 0:t.liveStreams)?i:[];(0,s.useEffect)(()=>{w.activityUnreadCount>0&&(0,u.u4)(u.qY.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:w.activityUnreadCount})},[w.activityUnreadCount]);let D=()=>Promise.all([n.e("39966"),n.e("28946"),n.e("14958")]).then(n.bind(n,18298)),k=w.activityUnreadCount;return(0,o.FD)(g.u,{trackingProps:{surface:"dropdown"},children:[(0,o.Y)(y.m_,{text:_("Activity"),side:"bottom",children:(0,o.Y)(h.A,{trigger:(0,o.FD)(p.K0,{"aria-label":"View activity",priority:"tertiary",onMouseEnter:D,position:"relative",children:[(0,o.Y)(a.A,{"aria-hidden":!0,size:20}),k>0&&(0,o.Y)(C,{count:k})]}),onOpen:()=>{S.refetch(),I.refetch()},children:(0,o.Y)(b.Ic,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:D,resource:S,bellCount:k,scheduledLiveStreams:A,onOpenScheduledModal:()=>P(!0),whileLoading:(0,o.Y)(m.az,{width:400})})})}),(0,o.Y)(f._,{isOpen:Y,onClose:()=>P(!1),scheduledLiveStreams:A,onCancelStream:()=>I.refetch()}),r&&(0,o.Y)(v.r,{})]})}function C(e){let{count:t}=e;return(0,o.Y)(_.pT,{className:r()(w.A.badge,t<10&&w.A.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}},38691:function(e,t,n){n.d(t,{a:()=>_});var o=n(4006),i=n(54687),r=n(17402),a=n(84605),s=n(86500),l=n(17028),c=n(37598),u=n(66511),d=n(70486),m=n(21398),p=n(57934);function _(){var e,t;let{iString:n}=(0,a.GO)(),_=null!=(t=null==(e=(0,d.a8)().data)?void 0:e.unreadCount)?t:0;return(0,r.useEffect)(()=>{(0,s.u4)(s.qY.CHAT_DROPDOWN_BADGE_SHOWN,{count:_})},[_]),(0,o.Y)(u.m_,{text:n("Chat"),side:"bottom",children:(0,o.Y)(c.A,{trigger:(0,o.FD)(l.K0,{"aria-label":"View chats",priority:"tertiary",onMouseEnter:h,position:"relative",children:[(0,o.Y)(i.A,{size:20}),_>0&&(0,o.Y)(p.X,{count:_})]}),onClose:()=>{(0,s.u4)(s.qY.CHAT_DROPDOWN_CLOSED)},children:(0,o.Y)(m.Ic,{module:"./MiniInbox",onRequest:h,resolve:e=>e.MiniChatInbox,whileLoading:(0,o.Y)(l.az,{width:360})})})})}let h=()=>Promise.all([n.e("23856"),n.e("83034"),n.e("71385"),n.e("95611"),n.e("52707"),n.e("71099"),n.e("20711"),n.e("74333"),n.e("463"),n.e("9189")]).then(n.bind(n,62845))},36319:function(e,t,n){n.d(t,{k_:()=>x});var o=n(69277),i=n(70408),r=n(4006),a=n(83673),s=n.n(a),l=n(63375),c=n.n(l),u=n(50014),d=n.n(u),m=n(17402),p=n(25250),_=n(46271),h=n(96467),y=n(94729),f=n(44333),g=n(68349),b=n(15144),v=n(30042),w=n(70486),Y=n(62488),C=n(26606),P=n(69911),S=n(26095),I=n(11510),A=n(43296),D=n(16291),k=n(38704);function x(e){let{children:t,surface:n}=e,{user:a,userSettings:s}=(0,_.ur)(),l=s.newest_seen_chat_item_published_at,[{path:c}]=(0,f.rd)(),u=(0,I.Iu)(),d=(0,A.XW)(),p=(0,A.$P)(),[y,g]=(0,h.K)(B,(0,i._)((0,o._)({},w.v$),{user:a,users:new Map(a?[[a.id,a]]:[])}));(0,w.a8)({auto:!!a});let v=(0,m.useRef)(0);return(0,m.useEffect)(()=>{if(d&&a)return d.listen({["user:".concat(a.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?g(X(e)):"chat:updated-post"===e.type?g(ee(e)):"chat:new-post"===e.type&&g(et(e))}}})},[d]),(0,m.useEffect)(()=>{"open"===p&&a&&g((0,b.D1)())},[p]),(0,m.useEffect)(()=>{if("open"!==p){let e,t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;a&&e-v.current>5e3&&"hidden"!==t&&(v.current=e,g((0,b.D1)()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2*Math.random()*1e3))},o=(0,S.x)(t);return c.startsWith("/chat")&&!u?n():t(),()=>{e&&clearTimeout(e),o()}}},[l,c,u,g,p]),(0,r.Y)(Y.t.Provider,{value:n,children:(0,r.Y)(w.qe.Provider,{value:g,children:(0,r.Y)(w.Vn.Provider,{value:y,children:t})})})}let F={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},N={isLoading:!1,hasMore:!1,error:null},E={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},M={before:N,after:(0,i._)((0,o._)({},N),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function B(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"!==t.type)return e;{var n;let r=t.payload,a=null!=(n=e.chats.get(r.id))?n:F;return(0,i._)((0,o._)({},e),{chats:(0,k.Jb)(e.chats,r.id,(0,i._)((0,o._)({},a),{publication:r})),publications:(0,k.Jb)(e.publications,r.id,r)})}}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:r,directMessagesUnreadCount:a,pendingInviteCount:l,pendingInviteUnreadCount:c,mostRecentChatTimestamp:u}=t.payload,d=(0,i._)((0,o._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...s()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,userStatus:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...s()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:r}=t,{id:a}=r;return[r.id,(0,i._)((0,o._)({},e.communityComments.get(a)),{comment:r,userId:r.user_id,quoteId:null!=(n=r.quote_id)?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...s()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let r=null!=(n=e.chats.get(t.publication.id))?n:F;return[t.publication.id,(0,i._)((0,o._)({},r),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...s()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,i._)((0,o._)({},E,n),{thread:t.messageThread})]}}))])}),m=n.map((t,n)=>{var r,a,s,l,c,u,d,m;return"chat"===t.type?(0,i._)((0,o._)({},t),{communityPostId:null!=(u=null==(r=t.communityPost)?void 0:r.id)?u:null,muteStatus:null!=(d=t.muteStatus)?d:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null==(s=e.user)||null==(a=s.primary_publication)?void 0:a.id)||(null==(l=e.inbox.threads.get(t.id))?void 0:l.isPrimary)}):(0,i._)((0,o._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!=(m=null==(c=t.recentMessage)?void 0:c.id)?m:null,isPrimary:!1})}),p=$(m),_=(0,k.ZZ)(e.inbox.threads,m,e=>e.id),h=$([..._.values()]),{filter:y}=e.inbox,f=(0,v.p)(y);return U((0,i._)((0,o._)({},d),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[f]:{hasMore:r&&p===h,isLoading:!1}}),threads:_,directMessagesUnreadCount:a,pendingInviteCount:l,pendingInviteUnreadCount:c,mostRecentChatTimestamp:u})}))}case"inbox-pin":{let{itemId:n,isPinned:r}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.uu)(e.inbox.threads,n,{isPinned:r})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.uu)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:s}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:a,pubChatUnreadCount:s})})}case"inbox-new_error":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[(0,v.p)(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:r}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.QA)(e.inbox.threads,W(r),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.QA)(e.inbox.threads,W(n),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,r=W(n.id);return(0,i._)((0,o._)({},e),{chats:(0,k.QT)(e.chats,n.id),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.QT)(e.inbox.threads,W(n.id)),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"pub_chat-join":{let n=t.payload;W(n.id);let r=(0,k.Jb)(e.inbox.threads,W(n.id),{id:W(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,o._)({},U((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:r}),chats:(0,k.QA)(e.chats,n.id,e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,k.Jb)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,r;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,r=e.conversations.get(n);if(r&&r.replyIds.length>0)return e;return(0,i._)((0,o._)({},e),{conversations:(0,k.Jb)(e.conversations,n,(0,o._)({},r,E))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let r=K(n);return(0,i._)((0,o._)({},e),{conversations:(0,k.QT)(e.conversations,n),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.QT)(e.inbox.threads,r),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"conversation-request_error":{let{conversationId:n,cursor:r,edge:a,error:s}=t.payload,l=e.conversations.get(n);if(!l)return console.error("Attempting to set an error on missing conversation"),e;if(l[a].cursor!==r)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,i._)((0,o._)({},e),{conversations:(0,k.Jb)(e.conversations,n,(0,i._)((0,o._)({},l),{[a]:{isLoading:!1,cursor:r,error:s}}))})}case"conversation-load_more":{let{edge:r,cursor:a,page:{thread:l,replies:c,publications:u,comments:d,pastCursor:m,futureCursor:p,profile:_,subscriberContext:h}}=t.payload,y=c.map(e=>e.comment.id),f=new Set(y),g=e.conversations.get(l.id);if(!g)return console.error("Attempting to load messages for missing conversation"),e;if(g[r].cursor!==a)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let b=g.replyIds.filter(e=>!f.has(e));b="before"===r?y.concat(b):b.concat(y);let v=(0,i._)((0,o._)({},g,a?{[r]:{isLoading:!1,cursor:"before"===r?m:p,error:null}}:{before:{isLoading:!1,cursor:m,error:null},after:{isLoading:!1,cursor:p,error:null}}),{thread:l,replyIds:b}),w=_&&(null==(n=l.members.find(e=>e.user_id===_.id))?void 0:n.user),Y=(0,i._)((0,o._)({},e),{conversations:(0,k.Jb)(e.conversations,l.id,v),communityComments:H(e.communityComments,c.flatMap(e=>s()([e,e.quote]).map(G)),e=>e.comment.id,e=>e.comment.created_at),users:(0,k.ZZ)(e.users,c.flatMap(e=>{var t;return s()([e.user,null==(t=e.quote)?void 0:t.user])}),e=>e.id),profiles:_?(0,k.Jb)(e.profiles,_.id,(0,i._)((0,o._)({},w,_),{subscriberContext:h})):e.profiles,publications:u?(0,k.ZZ)(e.publications,u,e=>e.id):e.publications,notes:d?(0,k.ZZ)(e.notes,d,e=>"c-".concat(e.id)):e.notes});if("after"===r||!a)return O(Y,l.id,null);return Y}case"conversation-comments-new":{let{conversationId:n,linkUrl:a,quoteReply:s}=t.payload,l=e.conversations.get(n);if(!l)throw Error("Attempted to post message to missing conversation");let c={comment:(0,i._)((0,o._)({},q(e,t.payload)),{quote_id:null!=(r=l.quoteReply)?r:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:a?{url:a,host:(0,g.EW)(a)}:void 0,quote:s,quoteId:null==s?void 0:s.comment.id},u=(0,i._)((0,o._)({},l),{quoteReply:null,replyIds:[...l.replyIds,c.comment.id]});return O((0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,c.comment.id,c),conversations:(0,k.Jb)(e.conversations,n,u)}),n,c.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:r,reply:a,publications:s,comments:l}=t.payload;n=null!=n?n:a.client_id;let c=e.conversations.get(r);if(!c)throw Error("Attempted to post message to missing conversation");let u=n&&e.communityComments.get(n),d=new Map(e.communityComments),m=G(a);d.set(a.comment.id,u?(0,i._)((0,o._)({},m),{clientId:u.clientId,comment:(0,i._)((0,o._)({},m.comment),{media_uploads:u.comment.media_uploads})}):m),a.quote&&d.set(a.quote.comment.id,G(a.quote));let p=c.replyIds,_=a.comment.id;return n&&(p=p.map(e=>e===n?_:e)),p.includes(_)||(p=[...p,_]),p=[...new Set(p)],O((0,i._)((0,o._)({},e),{conversations:(0,k.Jb)(e.conversations,r,(0,i._)((0,o._)({},c),{replyIds:p})),communityComments:d,publications:s?(0,k.ZZ)(e.publications,s,e=>e.id):e.publications,notes:l?(0,k.ZZ)(e.notes,l,e=>"c-".concat(e.id)):e.notes}),r,a.comment.id)}case"conversation-comments-error":{let{commentId:n,error:r}=t.payload,a=e.communityComments.get(n);if(!a)throw Error("Attempted to assing error to missing comment");if(!a.isNew)throw Error("Attempted to set error on persisted comment");return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},a),{error:r}))})}case"conversation-quote-set":{let{conversationId:n,commentId:r}=t.payload,a=e.conversations.get(n);if(!a)throw Error("Tried to quote a message in a conversation that does not exist");return(0,i._)((0,o._)({},e),{conversations:(0,k.Jb)(e.conversations,n,(0,i._)((0,o._)({},a),{quoteReply:r}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return R(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,i._)((0,o._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return R(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:o}=t.payload;return R(e,n,{unmute_at:o?(0,D.A)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=r!==a.comment.reaction;return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:J(a.comment,r,s)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,r,a,s,l,u;let{publication_id:d}=t.payload,m=null!=(n=e.chats.get(d))?n:F;switch(t.type){case"posts-request_initial":return(0,i._)((0,o._)({},e),{chats:(0,k.Jb)(e.chats,d,(0,i._)((0,o._)({},m),{after:(0,i._)((0,o._)({},m.after),{isLoading:!0})}))});case"posts-request_more":return(0,i._)((0,o._)({},e),{chats:(0,k.Jb)(e.chats,d,(0,i._)((0,o._)({},m),{before:(0,i._)((0,o._)({},m.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:r}=t.payload,a=n.threads.find(e=>"deleted"!==e.communityPost.status),s=H(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),l=W(d),u=(null==m?void 0:m.isLoaded)?{[r]:{isLoading:!1,hasMore:"before"===r?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},p=(0,i._)((0,o._)({},e),{users:(0,k.ZZ)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:s,chats:(0,k.Jb)(e.chats,d,(0,i._)((0,o._)({},m,u),{posts:c()([...m.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,o;return Q(null==(n=s.get(e))?void 0:n.communityPost.created_at,null==(o=s.get(t))?void 0:o.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.QA)(e.inbox.threads,l,e=>{var t,r;return"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!=(t=null==a?void 0:a.communityPost.id)?t:e.communityPostId,lastViewedAt:null!=(r=n.lastViewedAt)?r:null}):e})})});return(0,i._)((0,o._)({},p),{inbox:"before"===r?e.inbox:(0,i._)((0,o._)({},e.inbox),{threadList:V(p)})})}case"posts-error":{let{error:n,direction:r}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,k.Jb)(e.chats,d,(0,i._)((0,o._)({},m),{[r]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.uu)(e.inbox.threads,W(d),{lastViewedAt:new Date().toISOString()})}),chats:(0,k.Jb)(e.chats,d,(0,i._)((0,o._)({},m),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),s={communityPost:(0,i._)((0,o._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!=(a=null==(r=e.user)?void 0:r.id)?a:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0,userStatus:null};return(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,s.communityPost.id,s),chats:(0,k.Jb)(e.chats,d,(0,i._)((0,o._)({},m),{posts:[s.communityPost.id,...m.posts]}))})}case"posts-updated":{let{id:n,chatItem:r}=t.payload;if(!m.posts.includes(n))return e;let a=new Map(e.communityPosts);return a.set(r.communityPost.id,r),(0,i._)((0,o._)({},e),{communityPosts:a})}case"posts-new_incoming":{let{chatItem:n,publication_id:r,id:a}=t.payload,s=new Map(e.communityPosts);s.set(a,n);let l=Array.from(new Set([a,...m.posts]));return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.uu)(e.inbox.threads,W(r),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,k.Jb)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:s,chats:(0,k.Jb)(e.chats,r,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-commit":{let{id:n,chatItem:r,publication_id:a}=t.payload,s=new Map(e.communityPosts);s.delete(n),s.set(r.communityPost.id,r);let l=m.posts.includes(n)?m.posts.map(e=>e===n?r.communityPost.id:e):m.after.hasMore?m.posts:[r.communityPost.id,...m.posts];return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.uu)(e.inbox.threads,W(a),{communityPostId:r.communityPost.id})}),communityPosts:s,chats:(0,k.Jb)(e.chats,a,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!Z(a)||!(null==(s=a.communityPost)?void 0:s.reactions))return console.warn("chat item does not exist"),e;if(a.communityPost.reaction===r)return console.warn("already set this reaction",r),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:J(a.communityPost,r,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityPosts.get(n);if(!a||!Z(a)||!(null==(l=a.communityPost)?void 0:l.reactions))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:J(a.communityPost,r,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;let s=new Map(e.communityComments),l=e.comments.get(n);l&&l.comments.forEach(t=>{L(t,s);let n=e.replies.get(t);n&&n.comments.forEach(e=>{L(e,s)})});let c=null==(u=e.chats.get(r))?void 0:u.posts.filter(t=>{var o;if(t===n)return!1;let i=e.communityPosts.get(t);return(null==i||null==(o=i.communityPost)?void 0:o.status)!=="deleted"}).sort((t,n)=>{var o,i;let r=null==(o=e.communityPosts.get(t))?void 0:o.communityPost,a=null==(i=e.communityPosts.get(n))?void 0:i.communityPost;return Q(null==r?void 0:r.created_at,null==a?void 0:a.created_at)})[0],d=(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:s,inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.QA)(e.inbox.threads,W(r),e=>"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!=c?c:null}):e)})});return(0,i._)((0,o._)({},d),{inbox:(0,i._)((0,o._)({},d.inbox),{threadList:V(d)})})}case"posts-flag_post":{let{id:n}=t.payload,r=e.communityPosts.get(n);if(!r||!Z(r))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,n,(0,i._)((0,o._)({},r),{communityPost:(0,i._)((0,o._)({},r.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityPosts.get(n);if(!a||!Z(a))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{is_locked:r})}))})}case"posts-link_metadata":{let{id:n,link_metadata:r}=t.payload,a=e.communityPosts.get(n);if(!a)return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,i._)((0,o._)({},a.communityPost),{link_metadata:r})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:r,scrollCache:a}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,k.Jb)(e.chats,n,(0,i._)((0,o._)({},m),{scrollOffset:r,scrollCache:a}))})}case"posts-update_post":{let{id:n,post:r}=t.payload,a=e.communityPosts.get(n);if(!a||!Z(a))return console.warn("post does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,n,(0,i._)((0,o._)({},a),{communityPost:(0,o._)({},a.communityPost,r)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,i._)((0,o._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,r,a,l,u,d,m,p,_;let h,f=null,g=null;"parentCommentId"in(_=t).payload&&_.payload.parentCommentId?g=t.payload.parentCommentId:"postId"in t.payload&&(f=t.payload.postId);let b=e=>g?{replies:e}:{comments:e};h=g?null!=(n=e.replies.get(g))?n:M:f&&null!=(r=e.comments.get(f))?r:M;let v=g?e.replies:e.comments,w=null!=g?g:f;switch(t.type){case"replies-clear":case"comments-clear":return w?(0,o._)({},e,b((0,k.Jb)(v,w,M))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:r}=t.payload,s=(0,i._)((0,o._)({},N),{isLoading:!0,hasMore:!1}),l=r&&(null==h?void 0:h.comments.includes(r.id));return(0,o._)({},e,b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{before:"desc"===n?s:N,after:"asc"===n?s:N,order:n,target:null!=r?r:null,isLoaded:(!r||!!l)&&null!=(a=null==h?void 0:h.isLoaded)&&a}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,o._)({},e,b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:r,parent:a,replies:l,more:u,moreAfter:d,moreBefore:m,lastViewedAt:p}}=t.payload,_=null;if((null==r?void 0:r.communityPost.publication_id)&&(null==r?void 0:r.communityPost.muted)){let t={is_muted:!0,type:r.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==r?void 0:r.communityPost.publication_id)||F;n.muteStatus||(_=(0,k.Jb)(e.chats,r.communityPost.publication_id,(0,i._)((0,o._)({},n),{muteStatus:t})))}let y=l.map(e=>e.comment.id),f=H(e.communityComments,l.flatMap(e=>s()([e,e.quote]).map(G)),e=>e.comment.id,e=>e.comment.updated_at);a&&f.set(a.comment.id,(0,i._)((0,o._)({},a),{userId:a.user.id}));let g=(0,k.ZZ)(e.users,s()([null==r?void 0:r.communityPost.user,null==a?void 0:a.user]),e=>e.id),Y=w?v.get(w):null,C=(null==Y?void 0:Y.isLoaded)?{[n]:{isLoading:!1,hasMore:u,error:null}}:{before:{isLoading:!1,hasMore:m,error:null},after:{isLoading:!1,hasMore:d,error:null}};return(0,o._)((0,i._)((0,o._)((0,i._)((0,o._)({},e),{communityPosts:r?(0,k.Jb)(e.communityPosts,r.communityPost.id,r):e.communityPosts,communityComments:f}),_?{chats:_}:{}),{users:new Map([...g,...l.map(e=>[e.user.id,e.user])])}),b((0,k.Jb)(v,w,(0,i._)((0,o._)((0,i._)((0,o._)({},h),{comments:c()([...h.comments,...y]).sort((e,t)=>{var n,o;return Q(null==(n=f.get(e))?void 0:n.comment.created_at,null==(o=f.get(t))?void 0:o.comment.created_at)}).filter(e=>{var t;return(null==(t=f.get(e))?void 0:t.comment.status)!=="flagged"})}),C),{order:"after"!==n||u?h.order:"desc",isLoaded:!0,lastViewedAt:p}))))}case"replies-target":case"comments-target":return w?(0,o._)({},e,b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityPosts:(0,k.QA)(e.communityPosts,r,e=>(0,i._)((0,o._)({},e),{communityPost:(0,i._)((0,o._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityComments:(0,k.QA)(e.communityComments,r,e=>(0,i._)((0,o._)({},e),{comment:(0,i._)((0,o._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return w?(0,o._)({},e,b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return w?(0,o._)({},e,b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,r={comment:(0,i._)((0,o._)({},q(e,n)),{quote_id:null!=(d=null==(l=n.quoteReply)?void 0:l.comment.id)?d:null,post_id:n.postId,parent_id:g}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null==(u=n.quoteReply)?void 0:u.comment.id,pub_roles:n.pubRoles},a=(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,r.comment.id,r)}),b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{comments:[r.comment.id,...h.comments],lastViewedAt:new Date().toISOString()}))));if(g){let n=e.communityComments.get(g);if(n&&j(n)){let r=T(n.comment,e.user,t.payload.postId);a.communityComments.set(g,(0,i._)((0,o._)({},n),{comment:r}))}}let s=e.communityPosts.get(t.payload.postId);if(s&&Z(s)){let n=T(s.communityPost,e.user,t.payload.postId);a.communityPosts=(0,k.Jb)(e.communityPosts,t.payload.postId,(0,i._)((0,o._)({},s),{communityPost:n}))}return a}case"replies-commit":case"comments-commit":{let{id:n,reply:r}=t.payload,a=new Map(e.communityComments);a.delete(n),a.set(r.comment.id,G(r));let s=h.comments.includes(n)?h.comments.map(e=>e===n?r.comment.id:e):h.after.hasMore?h.comments:[r.comment.id,...h.comments];return(0,o._)((0,i._)((0,o._)({},e),{communityComments:a}),b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{comments:s}))))}case"comments-updated":{let{id:n,reply:r}=t.payload;if(!h.comments.includes(n))return e;let a=h.comments.map(e=>e===n?r.comment.id:e);return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,G(r))}),b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{comments:a}))))}case"comments-new_incoming":{let{id:n,reply:r}=t.payload;return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,G(r)),users:r.user?(0,k.Jb)(e.users,r.userId,r.user):e.users}),b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{comments:Array.from(new Set([r.comment.id,...h.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:r}=t.payload;if(r instanceof y.fk){let t=r.body.post;t&&(e=(0,i._)((0,o._)({},e),{communityPosts:(0,k.Jb)(e.communityPosts,t.communityPost.id,(0,i._)((0,o._)({},t),{pubRole:null,userStatus:null})),users:t.user?(0,k.Jb)(e.users,t.user.id,t.user):e.users}))}return(0,o._)({},e,b((0,k.Jb)(v,w,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{error:r})}))))}case"comments-new_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!j(a)||!(null==(m=a.comment)?void 0:m.reactions))return console.warn("comment does not exist"),e;if(a.comment.reaction===r)return console.warn("reaction already set"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:J(a.comment,r,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:r}=t.payload,a=e.communityComments.get(n);if(!a||!j(a)||!(null==(p=a.comment)?void 0:p.reactions))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:J(a.comment,r,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r)return console.warn("comment does not exist, cannot delete"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:r}=t.payload,a=e.communityComments.get(n);if(!a||!j(a))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:(0,o._)({},a.comment,r)}))})}case"comments-flag_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r||!j(r))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:r}=t.payload,a=e.communityComments.get(n);if(!a||!j(a))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},a),{is_banned:r}))})}case"comments-lock_replies":{let{id:n,isLocked:r}=t.payload,a=e.communityComments.get(n);if(!a||!j(a))return console.warn("comment does not exist"),e;if(a.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,k.Jb)(e.communityComments,n,(0,i._)((0,o._)({},a),{comment:(0,i._)((0,o._)({},a.comment),{is_locked:r})}))})}default:throw Error("Invalid type")}}(e,t):e}function T(e,t,n){var r,a;let s;return(t&&t.photo_url&&(s=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(s=d()([...s,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,i._)((0,o._)({},e),{recent_commenters:s,reply_count:1+(null!=(r=e.reply_count)?r:0)}):"comment_count"in e?(0,i._)((0,o._)({},e),{recent_commenters:s,comment_count:1+(null!=(a=e.comment_count)?a:0)}):e}function L(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,i._)((0,o._)({},n),{comment:(0,i._)((0,o._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function q(e,t){var n,r,a;let s;return(0,i._)((0,o._)({},{id:"",created_at:s=new Date().toISOString(),updated_at:s,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!=(r=t.mediaUploads)?r:null,user_id:null!=(a=null==(n=e.user)?void 0:n.id)?a:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function O(e,t,n){let r=K(t),a=e.inbox.threads.get(r),s=(null==a?void 0:a.type)==="direct-message"?a:null,l=(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,k.Jb)(e.inbox.threads,r,(0,i._)((0,o._)({timestamp:new Date().toISOString()},s),{id:r,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,i._)((0,o._)({},l),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:V(l)})})}function J(e,t,n){var r,a;let s=e.reaction,l=(0,o._)({},e.reactions);return l[t]=(null!=(r=l[t])?r:0)+(n?1:-1),n&&s&&(l[s]=(null!=(a=l[s])?a:0)-1),(0,i._)((0,o._)({},e),{reactions:l,reaction:n?t:null})}function U(e){return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:V(e)})})}function V(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:Q(z(e,t),z(e,n))).map(e=>e.id)}function z(e,t){var n,o,i,r;return"chat"===t.type?null!=(i=t.communityPostId&&(null==(o=e.communityPosts.get(t.communityPostId))?void 0:o.communityPost.created_at))?i:t.timestamp:null!=(r=null==(n=(0,P.H)(e,t))?void 0:n.comment.created_at)?r:t.timestamp}function R(e,t,n){let r=e.conversations.get(t),a=null==r?void 0:r.thread;if(!r||!a)throw Error("Tried to update a conversation that does not exist.");let s=e.user;if(!s)throw Error("Cannot update conversation if the user does not exist.");return(0,i._)((0,o._)({},e),{conversations:(0,k.Jb)(e.conversations,t,(0,i._)((0,o._)({},r),{thread:(0,i._)((0,o._)({},a),{members:a.members.map(e=>e.user_id===s.id?(0,o._)({},e,n):e)})}))})}function W(e){return"chat-".concat(e)}function K(e){return"direct-message-".concat(e)}function G(e){var t,n,r,a;return(0,i._)((0,o._)({},e),{userId:null==(t=e.user)?void 0:t.id,quoteId:null!=(a=null!=(r=null==(n=e.quote)?void 0:n.comment.id)?r:e.comment.quote_id)?a:void 0})}function Z(e){return!0!==e.isNew}function j(e){return!0!==e.isNew}function Q(e,t){return e===t?0:!t||e&&e>t?-1:1}function H(e,t,n,i){let r=new Map(e);for(let e of t){let t=n(e),a=r.get(t);if(!a){r.set(t,e);continue}i(e)>=i(a)&&r.set(t,(0,o._)({},a,e))}return r}function $(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var o;let i=null!=(o=n.timestamp)?o:t;return i<e?i:e},t)}let X=e=>async(t,n)=>{let o=e.reply.comment.post_id;n().conversations.get(o)||await t((0,C.i)(o)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,p.Tk)("/api/v1/messages/unread-count")},ee=e=>async t=>{var n,r;let{post:a}=e;t("deleted"===a.status?{type:"posts-delete_post",payload:{id:a.id,publication_id:a.publication_id}}:{type:"posts-updated",payload:{id:a.id,chatItem:{communityPost:(0,i._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null==(n=a.user_pub_role_object)?void 0:n.role}),pubRole:null!=(r=a.user_pub_role_object)?r:null,userStatus:null}}})},et=e=>async t=>{var n,r;let{post:a}=e;t({type:"posts-new_incoming",payload:{publication_id:a.publication_id,id:a.id,chatItem:{communityPost:(0,i._)((0,o._)({},a),{user:a.author,user_id:a.author.id,is_locked:!1,is_edited:!1,user_pub_role:null==(n=a.user_pub_role_object)?void 0:n.role}),pubRole:null!=(r=a.user_pub_role_object)?r:null,userStatus:null}}})}},29611:function(e,t,n){n.d(t,{v:()=>a});var o=n(4006),i=n(94729),r=n(36372);function a(){let e=(0,r.d)();return(t,n)=>{e.popToast(()=>(0,o.Y)(r.y,{text:(0,i.Qd)(t,n)}))}}},8312:function(e,t,n){n.d(t,{OK:()=>c});var o=n(69277);let i="'SF Pro Display', -apple-system, system-ui, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'",r=[{label:"Serif",families:[{name:"Andada Pro",weights:[600,700,800],defaultWeight:800,fallback:"sans-serif"},{name:"Besley",weights:[700,800,900],defaultWeight:700,fallback:"sans-serif"},{name:"Bitter",weights:[600,700,800,900],defaultWeight:700,fallback:"sans-serif"},{name:"IBM Plex Serif",weights:[500,600,700],defaultWeight:700,fallback:"sans-serif"},{name:"Lora",weights:[500,600,700],defaultWeight:600,fallback:"sans-serif"},{name:"Roboto Slab",weights:[600,700,800,900],defaultWeight:700,fallback:"sans-serif"},{name:"STIX Two Text",weights:[500,600,700],defaultWeight:700,fallback:"sans-serif"},{name:"Yrsa",weights:[500,600,700],defaultWeight:700,fallback:"sans-serif"}]},{label:"Sans Serif",families:[{name:"System",weights:[700,900],defaultWeight:700,fallback:"sans-serif",keys:{700:"sans",900:"heavy_sans"}},{name:"Fira Sans",weights:[600,700,800,900],defaultWeight:700,fallback:"sans-serif"},{name:"Inter Tight",weights:[600,700,800,900],defaultWeight:700,fallback:"sans-serif"},{name:"Lato",weights:[700,900],defaultWeight:900,fallback:"sans-serif"},{name:"Nunito Sans",weights:[600,700,800,900],defaultWeight:800,fallback:"sans-serif"},{name:"PT Sans",weights:[700],defaultWeight:700,fallback:"sans-serif"},{name:"Raleway",weights:[600,700,800,900],defaultWeight:700,fallback:"sans-serif"},{name:"Roboto",weights:[600,700,800,900],defaultWeight:700,fallback:"sans-serif"},{name:"Source Sans 3",weights:[600,700,800,900],defaultWeight:800,fallback:"sans-serif"}]},{label:"Monospace",families:[{name:"Roboto Mono",weights:[500,600,700],defaultWeight:700,fallback:"monospace"}]}],a=[{name:"Lora",weights:[400],defaultWeight:400,fallback:"sans-serif"},{name:"Roboto Mono",weights:[400],defaultWeight:400,fallback:"monospace"},{name:"Roboto Slab",weights:[400],defaultWeight:400,fallback:"sans-serif"},{name:"Spectral",weights:[400],defaultWeight:400,fallback:"sans-serif"}];[...r.flatMap(e=>e.families).filter(e=>!("keys"in e)),...a];function s(e,t){if(!("keys"in t))for(let o of t.weights){var n;let i={font:t.name,weight:o,fallback:t.fallback};e[n=t.name,"".concat(n.toLowerCase().replace(/ /g,"_"),"_").concat(o)]=i}}let l=function(){let e={},t={};for(let t of r)for(let n of t.families)s(e,n);for(let e of a)s(t,e);return{heading:e,body:t}}();for(let[e,t]of Object.entries({fancy_serif:"lora_600",mono:"roboto_mono_700",slab:"roboto_slab_700"})){let n=l.heading[t];n&&(l.heading[e]=n)}for(let[e,t]of Object.entries({fancy_serif:"lora_400",classic_serif:"spectral_400",mono:"roboto_mono_400",slab:"roboto_slab_400"})){let n=l.body[t];n&&(l.body[e]=n)}let c=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;if("sans"===e)return{fontFamily:i,fontWeight:700};if("heavy_sans"===e)return{fontFamily:i,fontWeight:900};let n=l.heading[e];if(!n)return null;let r=n.font.match(" ")?"'".concat(n.font,"'"):n.font;return(0,o._)({fontFamily:t?n.fallback:[r,n.fallback].join(",")},n.weight&&{fontWeight:n.weight})}}}]);